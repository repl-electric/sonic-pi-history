beat = 1


def live(name, amp, &block)
  idx = 0
  x = lambda{|idx|
    with_fx :level, amp: amp do
      block.(idx)
    end}
  live_loop name do |idx|
    x.(idx)
  end
end

live :test, 0.1 do |x|
  puts x
  play 60
sleep beat
  x+=1
end