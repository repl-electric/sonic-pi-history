beat = 1


def live(name, opts={}, &block)
  idx = 0
  amp = if(opts[:amp])
    opts[:amp]
  else
    1
  end 

  x = lambda{|idx|
    with_fx :level, amp: amp do
      block.(idx)
    end}
  live_loop name do |idx|
    x.(idx)
  end
end

live :test, amp: 0.9 do |x|
  puts x
  play 60
sleep beat
  x+=1
end