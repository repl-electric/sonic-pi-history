["log","experiments", "shaderview"].each{|f| load "/Users/josephwilk/Workspace/repl-electric/live-coding-space/lib/#{f}.rb"}
t=true;f=false;_=nil
#Just messing around, will see what happens.

#ok back...
live_loop :apeg do
  # Should remove that little glitch... Slowly change over 2s
  with_fx(:reverb, room: 1.0, mix: 1.0, reps:4, damp_slide: 2.0) do |fx|
    use_random_seed (ring 300, 200).tick(:seed)
    notes = scale(:Fs3, :minor_pentatonic, num_octaves: 2).drop((knit 0,8,2,8,1,8).tick(:drop)).take(3).shuffle
    16.times{
      note = notes.tick(:n)
      with_transpose(-12) do
        with_synth(:hollow) do
          play note, release: 0.1, cutoff: (rrand 70,90), amp: 0.4+rand
        end
      end
      #Lovely little trick in Sonic Pi. Can only be done with safe mode off =>
      control fx, damp: rrand(0.5,1.0)

      #Meh, I've not a fan of blade.... Lets try something else
      with_synth(:hoover){ #Once I start hoover I cannot stop. Everything will die.
                           #Did I kill it? No its still alive
                           play note, cutoff: (rrand 85, 95),
                           amp: rand*0.06, attack: (ring 0.01,0.03).tick(:attack),
                           release: 0.1, pan: rdist(1)
                           }

      with_transpose(-24){
        with_synth(:dsaw){
          play (knit note, 1, _, 31).tick(:bass), cutoff: 50, amp: 0.08, detune: 12, release: 8.0
        }

        with_synth(:prophet){
          play (knit note, 1, _, 31).look(:bass), cutoff: 55, amp: 0.1, decay: 8.1, attack: 0.01
        }
      }


      sleep 0.125
    }
  end
end

live_loop :werbling do
  with_fx(:slicer, mix: 0.8, phase: 0.25) do
    #sample Dust[/F#m/, /voice/, 0], cutoff: (range 40, 60, 5).tick
  end

  sample Corrupt[/F#m/, /Guitar/,3], cutoff: 100, amp: 0.2+rand*0.2, rate: 0.5
  notes = (ring
           chord(:Fs3, :m),
           chord(:A3, 'M'),
           chord_degree(6, :Fs3, :minor),
           chord(:Cs3, 'm'),
           chord(:Cs3, 'm9')
           ).tick

  with_synth(:dark_ambience){
    play notes, decay: 8.5, amp: 1.0, detune1: (ring 24, 24).tick(:d),
    detune2: (ring -24, 0).tick(:d2), cutoff: 110
  }
  sleep 8
end

live_loop :kick do
  with_fx(:echo, phase: 0.25, decay: 0.01) do
    with_fx(:slicer, phase: 0.125) do
      sample Corrupt[/kick/,[2,3]].tick(:kick), amp: 0.3, cutoff: (rrand 60, 70)
    end
  end
  sleep 4
end